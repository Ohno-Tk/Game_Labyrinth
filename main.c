/*=============================================================================

	main.c

-------------------------------------------------------------------------------
  Author
	Ohno Takuya

  Create
	2017/6/6
=============================================================================*/
/*-----------------------------------------------------------------------------
	warning
-----------------------------------------------------------------------------*/
#define _CRT_SECURE_NO_WARNINGS

/*-----------------------------------------------------------------------------
	include
-----------------------------------------------------------------------------*/
#include <stdio.h>

/*-----------------------------------------------------------------------------
	Macro
-----------------------------------------------------------------------------*/
#define MAP_W (50)/*MAP_Width*/
#define MAP_H (23)/*MAP_Height*/

#define Clear_W (79)/*Clear_Width*/
#define Clear_H (25)/*Clear_Height*/

#define Gameover_W (79)/*Gameoverの横幅*/
#define Gameover_H (50)/*Gameover_Height*/

#define TIME (100)

/*-----------------------------------------------------------------------------
	プロトタイプ宣言
-----------------------------------------------------------------------------*/
int meiro(void);
int Clear(void);
int Gameover(void);

/*-----------------------------------------------------------------------------
	グローバル変数
-----------------------------------------------------------------------------*/
int Time;
int choose = 0;

/*-----------------------------------------------------------------------------
	main
-----------------------------------------------------------------------------*/
int  main(void)
{

	for (;;)
	{
		meiro();
		system("cls");

		if (Time != 0)
		{
			Clear();
		}
		else
		{
			Gameover();
		}
	}

	return 0;
}

/*-----------------------------------------------------------------------------
	ゲーム
-----------------------------------------------------------------------------*/
int meiro(void)
{
	Time = TIME;


	char MAPdata[MAP_H][MAP_W] = {
		"||G--------------------------------------------**",
		"||                                             ||",
		"|| * * * * * * * * * * * * * * * * * * * * * * ||",
		"||                                             ||",
		"|| * * * * * * * * * * * * * * * * * * * * * * ||",
		"||                                             ||",
		"|| * * * * * * * * * * * * * * * * * * * * * * ||",
		"||                                             ||",
		"|| * * * * * * * * * * * * * * * * * * * * * * ||",
		"||                                             ||",
		"|| * * * * * * * * * * * * * * * * * * * * * * ||",
		"||                                             ||",
		"|| * * * * * * * * * * * * * * * * * * * * * * ||",
		"||                                             ||",
		"|| * * * * * * * * * * * * * * * * * * * * * * ||",
		"||                                             ||",
		"|| * * * * * * * * * * * * * * * * * * * * * * ||",
		"||                                             ||",
		"|| * * * * * * * * * * * * * * * * * * * * * * ||",
		"||                                             ||",
		"|| * * * * * * * * * * * * * * * * * * * * * * ||",
		"||                                             ||",
		"**---------------------------------------------**" };
	int x, y, z;/*繰り返す変数*/
	int DAM;/*ランダム変数*/
	int player_x = 46, player_y = 21;/*プレイヤーの座標*/
	char key;/*移動処理に使う変数*/
	srand((unsigned)time(NULL));

	/*上下左右に壁を出現*/
	for (z = 2;z < 21;z += 2)
	{
		for (x = 3;x < 46;x += 2)
		{
			DAM = rand() % 4;
			if (DAM == 0)/*左*/
			{
				MAPdata[z][x - 1] = '*';
			}
			else if (DAM == 1)/*上*/
			{
				MAPdata[z - 1][x] = '*';
			}
			else if (DAM == 2)/*下*/
			{
				MAPdata[z][x + 1] = '*';
			}
			else if (DAM == 3)/*右*/
			{
				MAPdata[z + 1][x] = '*';
			}
		}
	}

	while (MAPdata[player_y][player_x] != 'G' && Time != 0)
	{
		system("cls");
		MAPdata[player_y][player_x] = 'P';/*プレイヤーの表示*/

		/*マップ表示*/
		for (y = 0;y < MAP_H;y++)
		{
			printf("%s", &MAPdata[y][0]);
			printf("\n");
		}

		/*移動処理*/
		printf("操作方法::←　→　↑　↓　 Ｇを目指せ！！　残りターン:%3d\n", Time);

		MAPdata[player_y][player_x] = ' ';/*座標更新*/

		key = _getch();/*キーの取得*/
		if (key == 72)/*↑キー*/
		{
			player_y--;
			Time--;
			/*壁との当たり判定*/
			if (MAPdata[player_y][player_x] == '*' || MAPdata[player_y][player_x] == '-')
			{
				player_y++;
				Time++;
			}
		}
		else if (key == 80)/*↓キー*/
		{
			player_y++;
			Time--;
			/*壁との当たり判定*/
			if (MAPdata[player_y][player_x] == '*' || MAPdata[player_y][player_x] == '-')
			{
				player_y--;
				Time++;
			}
		}
		else if (key == 75)/*←キー*/
		{
			player_x--;
			Time--;
			/*壁との当たり判定*/
			if (MAPdata[player_y][player_x] == '*' || MAPdata[player_y][player_x] == '|')
			{
				player_x++;
				Time++;
			}
		}
		else if (key == 77)/*→キー*/
		{
			player_x++;
			Time--;
			/*壁との当たり判定*/
			if (MAPdata[player_y][player_x] == '*' || MAPdata[player_y][player_x] == '|')
			{
				player_x--;
				Time++;
			}
		}
	}
	return 0;
}

/*-----------------------------------------------------------------------------
	クリア
-----------------------------------------------------------------------------*/
int Clear(void)
{
	char Cleardata[Clear_H][Clear_W] = {

		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　●●●●●●　●　　●　　●●●●●●●●　　　●　　●　",
		"　　　　　　　　●　　　　●　　●　　●　　　　　　　　●　　　　●　　●　",
		"　　　　　　　●　　　　●　　　●　　●　　　　　●　●　　　　　●　　●　",
		"　　　　　　　　　　　●　　　　●　　●　　　　　●　　　　　　　●　　●　",
		"　　　　　　　　　　●　　　　　　　　●　　　　　●　　　　　　　●　　●　",
		"　　　　　　　　　●　　　　　　　　●　　　　　　●　　　　　　　●　　●　",
		"　　　　　　　　●　　　　　　　　●　　　　　　●　　　　　　　　　　　　　",
		"　　　　　　　●　　　　　　　　●　　　　　　●　　　　　　　　　●　　●　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　　　ＰＬＥＡＳＥ　　ＭＥ　　ＥＮＴＥＲ　　　　　　　　　　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　",
		"　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　　" };
	int y;

	for (y = 0;y < Clear_H;y++)
	{
		printf("%s", &Cleardata[y][0]);
		printf("\n");
	}


	rewind(stdin);
	getchar();
	system("cls");

	return 0;
}

/*-----------------------------------------------------------------------------
	ゲームオーバー
-----------------------------------------------------------------------------*/
int Gameover(void)
{
	char Gameoverdata[Gameover_H][Gameover_W] = {

		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"    *****      *      *       *  ******   *****    *       *  ******  ******  ",
		"   *          * *     * *   * *  *       *     *    *     *   *       *     * ",
		"  *   ***    *   *    *  * *  *  *****  *       *    *   *    *****   ******  ",
		"   *    *   *******   *   *   *  *       *     *      * *     *       *   *   ",
		"    *****  *       *  *       *  ******   *****        *      ******  *    *  ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                          PLEASE  ME  ENTER                                   ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",

		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                   +----------------------------------+                       ",
		"                   |                                  |                       ",
		"                   | 制限時間前にゴールを目指そう！！ |                       ",
		"                   |                                  |                       ",
		"                   | ENTERを押して下さい・・・        |                       ",
		"                   |                                  |                       ",
		"                   +----------------------------------+                       ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              ",
		"                                                                              " };
	int y;

	for (y = 0;y < 25;y++)
	{
		printf("%s", &Gameoverdata[y][0]);
		printf("\n");
	}

	rewind(stdin);
	getchar();
	system("cls");

	for (;y < Gameover_H;y++)
	{
		printf("%s", &Gameoverdata[y][0]);
		printf("\n");
	}

	rewind(stdin);
	getchar();
	system("cls");

	return 0;
}
